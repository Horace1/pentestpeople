<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Support\Facades\DB;

class Ticket extends Model
{
    use HasFactory;

    protected $fillable = [
        'ticket_subject',
        'ticket_content',
        'name',
        'email',
        'time',
        'status'
    ];

    public function numberOfTicketsInDatabase()
    {
        return self::count();
    }

    public function numberOfunprocessedTicketsInTheDatabase()
    {
        $unprocessedTickets = self::where('status', 0);
        return $unprocessedTickets->count();
    }

    public function nameOfUserWhoSubmittedTheHighestNumberOfTickets()
    {
        $unprocessedTickets = self::select('name')
            ->selectRaw('COUNT(email) as email_count')
            ->orderBy('email_count', 'desc')
            ->groupBy('name')
            ->first();

        return $unprocessedTickets;
    }

    public function lastProcessedTicket()
    {
        $unprocessedTickets = self::latest('created_at')->first();
        return date('H:i:s', strtotime($unprocessedTickets->created_at));
    }

}
